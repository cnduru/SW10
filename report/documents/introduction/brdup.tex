\paragraph{Code duplication}as described by~\cite[p. 12]{javasec} is a countermeasure which protects against corruption of data at execution time, such as register values. In extension, it can protect against a change in a program's control flow, by duplicating instructions which are used to determine values which affect branching.\\\\
An example could be some original program, as the one in \cref{lst:dup0}\ch{can this code sample be removed to save room?}, which loads two values from local variables (line 1-2), pushes them onto the operand stack and compares them. If the two values are the same, a jump is performed to a code region with sensitive code (line 8-9), which approves a transaction on a credit card.\\\\
Now, assume that a bit flip has occured in the flag set by the comparison in line 3. Before the flip, the rejection code would have been executed, but after the flip, the \texttt{acceptTransaction()} is executed. When code duplication is implemented, as in~\cref{lst:dup1}, redundant instructions are inserted. In line 8-9, the values of the local variables are loaded again and pushed onto the operand stack. Afterwards, the compare flag is set again, and another jump is made to the sensitive code region in lines 15-16. It should be noted that this particular duplication only protects a \textit{single} bit flip in the original portion of the code. If a second bit flip occurs in the duplicated part of the code to affect the jump, the program can still execute \texttt{acceptTransaction()}, even though it should not.

\begin{minipage}{\linewidth}
\begin{lstlisting}[caption={Original program without code duplication implemented. The code is written in \jcl. Note that for simplicity, the numbers in the left side are line numbers and do not denote the program counter values.}, label={lst:dup0}]
...
1: LOAD 1;
2: LOAD 2;
3: IF_CMPEQ 8;
<rejection code>
8: PUSH 0;
9: INVOKEVIRTUAL 12;  // acceptTransaction();
...
\end{lstlisting}
\end{minipage}

\begin{minipage}{\linewidth}
\begin{lstlisting}[caption={Modified program with code duplication implemented. The code is written in \jcl. Note that for simplicity, the numbers in the left side are line numbers and do not denote the program counter values.}, label={lst:dup1}]
...
1: LOAD 1;
2: LOAD 2;
3: IF_CMPEQ 8;
<rejection code>
8: LOAD 1;
9: LOAD 2;
10: IF_CMPEQ 15;
<bit flip detected code>
15: PUSH 0;
16: INVOKEVIRTUAL 12;  // acceptTransaction();
...
\end{lstlisting}
\end{minipage}